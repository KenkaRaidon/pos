<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; connect-src http://localhost:3000; media-src 'self' mediastream:; img-src 'self' data: blob:;">
    <title>Sistema POS - Punto de Venta</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Panel Izquierdo: Ticket de Venta -->
        <div class="left-panel">
            <div class="page-header">
                <h1 class="page-title">Ticket de Venta</h1>
                <p class="page-subtitle">Escanea productos o busca manualmente</p>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 50px;">#</th>
                            <th style="width: 120px;">Cantidad</th>
                            <th>Producto</th>
                            <th style="width: 120px;">Precio</th>
                            <th style="width: 150px;">Importe</th>
                        </tr>
                    </thead>
                    <tbody id="cart-body">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #95a5a6; padding: 60px;">
                                <div class="icon-cart" style="font-size: 64px; margin-bottom: 16px; opacity: 0.3;">üõí</div>
                                <p style="font-size: 18px; font-weight: 600;">El carrito est√° vac√≠o</p>
                                <p style="font-size: 14px; margin-top: 8px;">Escanea un producto para comenzar</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Panel Derecho: Scanner y Totales -->
        <div class="right-panel">
            <!-- Secci√≥n del Scanner -->
            <div class="scanner-section" id="scanner-section">
                <!-- Bot√≥n para activar/desactivar c√°mara -->
                <button id="toggle-scanner-btn" class="btn btn-primary btn-lg" style="width: 100%; margin-bottom: 20px;">
                    üì∑ ACTIVAR C√ÅMARA
                </button>

                <!-- Contenedor del esc√°ner de c√°mara -->
                <div id="qr-reader" style="display: none; margin-bottom: 20px;"></div>

                <div class="input-group">
                    <label class="input-label">
                        üîç O ESCANEAR CON LECTOR DE C√ìDIGOS
                    </label>
                    <input 
                        type="text" 
                        id="barcode-input" 
                        class="input barcode-input"
                        placeholder="Escanea aqu√≠..." 
                        autofocus
                        autocomplete="off"
                    >
                </div>

                <!-- Mensaje de estado -->
                <div id="status-msg" class="status-msg"></div>
            </div>

            <!-- Card de Total -->
            <div class="total-card">
                <div class="total-label">üí∞ TOTAL A PAGAR</div>
                <div class="total-amount">
                    $<span id="total-amount">0.00</span>
                </div>
                <div class="total-items">
                    Total de art√≠culos: <span id="total-items">0</span>
                </div>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="actions-section">
                <button id="cobrar-btn" class="btn btn-success btn-lg">
                    üí≥ COBRAR (F12)
                </button>
                
                <button id="clear-cart-btn" class="btn btn-danger btn-lg">
                    üóëÔ∏è VACIAR CARRITO (ESC)
                </button>
            </div>

            <!-- Footer info -->
            <div class="app-footer">
                <p>Sistema POS v1.0</p>
                <p>Presiona F1 para enfocar el scanner</p>
                <a href="catalog.html" style="color: #3498db; text-decoration: none; margin-top: 8px; display: block;">
                    üì¶ Ver Cat√°logo de Productos
                </a>
            </div>
        </div>
    </div>

    <!-- Modal de Registro R√°pido -->
    <div id="quick-register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ö° Producto No Encontrado</h2>
                <p class="modal-subtitle">¬øQuieres registrar este producto nuevo?</p>
            </div>

            <form id="quick-register-form" class="modal-body">
                <div class="input-group">
                    <label class="input-label" for="qr-barcode">
                        üì¶ C√≥digo de Barras
                    </label>
                    <input 
                        type="text" 
                        id="qr-barcode" 
                        class="input"
                        readonly
                        style="background: #f8f9fa; cursor: not-allowed;"
                    >
                </div>

                <div class="input-group">
                    <label class="input-label" for="qr-name">
                        üè∑Ô∏è Nombre del Producto *
                    </label>
                    <input 
                        type="text" 
                        id="qr-name" 
                        class="input"
                        placeholder="Ej: Coca-Cola 600ml"
                        required
                        autofocus
                    >
                </div>

                <div class="input-group">
                    <label class="input-label" for="qr-description">
                        üìù Descripci√≥n
                    </label>
                    <textarea 
                        id="qr-description" 
                        class="input"
                        placeholder="Descripci√≥n del producto (opcional)"
                        rows="2"
                    ></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="input-group">
                        <label class="input-label" for="qr-cost-price">
                            üí∞ Precio de Costo *
                        </label>
                        <input 
                            type="number" 
                            id="qr-cost-price" 
                            class="input"
                            placeholder="0.00"
                            step="0.01"
                            min="0"
                            required
                        >
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="qr-sale-price">
                            üíµ Precio de Venta *
                        </label>
                        <input 
                            type="number" 
                            id="qr-sale-price" 
                            class="input"
                            placeholder="0.00"
                            step="0.01"
                            min="0.01"
                            required
                        >
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="input-group">
                        <label class="input-label" for="qr-current-stock">
                            üì¶ Stock Inicial
                        </label>
                        <input 
                            type="number" 
                            id="qr-current-stock" 
                            class="input"
                            placeholder="0"
                            min="0"
                            value="0"
                        >
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="qr-min-stock">
                            ‚ö†Ô∏è Stock M√≠nimo
                        </label>
                        <input 
                            type="number" 
                            id="qr-min-stock" 
                            class="input"
                            placeholder="5"
                            min="0"
                            value="5"
                        >
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label" style="display: flex; align-items: center; gap: 8px;">
                        <input 
                            type="checkbox" 
                            id="qr-is-bulk"
                            style="width: auto; height: auto;"
                        >
                        ‚öñÔ∏è Producto a Granel (se vende por peso)
                    </label>
                </div>

                <div class="modal-footer">
                    <button type="button" id="qr-cancel-btn" class="btn btn-secondary btn-lg">
                        ‚ùå CANCELAR
                    </button>
                    <button type="submit" id="qr-save-btn" class="btn btn-success btn-lg">
                        üíæ GUARDAR Y AGREGAR
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts en orden de dependencia -->
    <script src="../../node_modules/html5-qrcode/html5-qrcode.min.js"></script>
    <script src="js/utils/api.js"></script>
    <script src="js/modules/cart.js"></script>
    <script src="js/modules/products.js"></script>
    <script src="js/modules/sales.js"></script>
    <script src="js/modules/scanner.js"></script>
    <script src="js/modules/quick-register.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
